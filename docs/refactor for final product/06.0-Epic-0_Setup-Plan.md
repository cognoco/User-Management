# Epic 0: Foundational Setup Plan

**Version:** 1.0
**Status:** DRAFT

## 1. Introduction

This document provides the master checklist of tasks required to establish the foundational infrastructure, CI/CD, and development environment for the PUMP project. It is intended to be executed sequentially to ensure a stable and consistent setup.

Each task references the canonical implementation details and "golden configurations" located in the **[Implementation Guide](./03.2-Implementation-Guide.md)**.

## 2. Core Tasks

### Story 1: Project & Repository Setup
- [ ] **Task 1.1:** Initialize the pnpm workspaces monorepo structure.
- [ ] **Task 1.2:** Set up required `.gitignore`, `.editorconfig`, and Prettier/ESLint configurations.
- [ ] **Task 1.3:** Configure GitHub repository settings (e.g., branch protection rules for `main`).

### Story 2: Local Development Environment
- [ ] **Task 2.1:** Create the production `Dockerfile` in the project root.
    -   *Reference: [Implementation Guide](./03.2-Implementation-Guide.md#5-golden-configurations)*
- [ ] **Task 2.2:** Create the `docker-compose.yml` for local development.
    -   *Reference: [Implementation Guide](./03.2-Implementation-Guide.md#5-golden-configurations)*
- [ ] **Task 2.3:** Add a local data seeding script to `scripts/seed.ts`.
    -   *Reference: [Implementation Guide](./03.2-Implementation-Guide.md#5-golden-configurations)*
- [ ] **Task 2.4:** Write comprehensive documentation in the root `README.md` on how to set up and run the local environment for the first time.

### Story 3: CI/CD Pipeline
- [ ] **Task 3.1:** Create the GitHub Actions workflow for continuous integration (`.github/workflows/ci.yml`).
    -   **Workflow Steps:**
        -   [ ] Checkout code
        -   [ ] Install dependencies (`pnpm install`)
        -   [ ] Run linter
        -   [ ] Run all tests (unit, integration)
        -   [ ] Build the Docker image
    -   *Reference: [Implementation Guide](./03.2-Implementation-Guide.md#5-golden-configurations)*

### Story 4: Deployment Pipeline & Hosting
- [ ] **Task 4.1:** Choose and configure the MVP hosting provider (e.g., Render, Railway).
- [ ] **Task 4.2:** Set up the production and staging Supabase projects.
- [ ] **Task 4.3:** Configure the Container Registry (e.g., GHCR).
- [ ] **Task 4.4:** Create the GitHub Actions workflow for deployment (`.github/workflows/deploy.yml`).
    -   **Workflow Triggers:**
        -   [ ] On push to `main` (deploys to Production)
        -   [ ] On PR to `main` (deploys to Preview/Staging)
    -   **Workflow Steps:**
        -   [ ] Build and push Docker image to registry.
        -   [ ] Trigger hosting provider to deploy the new image.
    -   *Reference: [Implementation Guide](./03.2-Implementation-Guide.md#5-golden-configurations)*

### Story 5: Secrets Management
- [ ] **Task 5.1:** Establish the `.env.example` file with all required variables.
- [ ] **Task 5.2:** Configure secrets in the GitHub repository for the CI/CD pipeline.
- [ ] **Task 5.3:** Configure environment variables in the chosen hosting provider for all environments.

### Story 6: Error Handling & Logging
- [ ] **Task 6.1:** Review the legacy `Error Code Reference.md` and define the canonical set of tRPC error codes for the new platform.
- [ ] **Task 6.2:** Implement a tRPC middleware to handle error logging using Pino.
- [ ] **Task 6.3:** Configure and test the Sentry integration for error reporting.

### Story 7: Test Data Management
- [ ] **Task 7.1:** Create a programmatic database seeding script using Prisma or a similar tool.
- [ ] **Task 7.2:** The script MUST be able to generate a consistent set of test users with different roles and states.
- [ ] **Task 7.3:** Create a script or command to easily reset the local and staging databases to a clean, seeded state.

### Story 8: Define-PUMP-Error-Codes
- [ ] **Task 8.1:** Populate the 'Custom Error Code Reference' in `ImplementationGuide.md` with the initial set of errors needed for MVP features.

## 3. Detailed Stories & Acceptance Criteria

### Story: `Setup-Documentation`
- **As a:** Vimes, the System Architect
- **I want:** The foundational documentation (`Architecture.md`, `ImplementationGuide.md`, `Development-Methodology.md`) to be created and populated with the core decisions made.
- **So that:** All current and future developers (human or AI) have a clear and consistent source of truth for project standards and design.
- **Acceptance Criteria:**
    - [x] `Architecture.md` is created and contains the finalized sections 1-23.
    - [x] `ImplementationGuide.md` is created and contains placeholder sections for "Golden Configurations" and other tactical guides.
    - [x] `Development-Methodology.md` is created and contains the full Git workflow and AI agent interaction protocols.

### Story: `Setup-Project-Repository`
- **As a:** Dev Team
- **I want:** The pnpm workspaces monorepo to be initialized with the correct directory structure.
- **So that:** We have a clean foundation for all subsequent code and configuration.
- **Acceptance Criteria:**
    - [ ] The repository is created on GitHub.
    - [ ] The high-level directory structure from `Architecture.md` is created.
    - [ ] pnpm is initialized in the root.

### Story: `Setup-Base-CI`
- **As a:** Dev Team
- **I want:** A basic CI pipeline in GitHub Actions that runs on every Pull Request.
- **So that:** We can automatically enforce code quality and prevent broken code from being merged.
- **Acceptance Criteria:**
    - [ ] A GitHub Actions workflow is created.
    - [ ] The workflow runs `pnpm install`.
    - [ ] The workflow runs the linter (`eslint`) and formatter (`prettier`) checks.
    - [ ] The workflow runs the build command (`pnpm build`).
    - [ ] The PR is blocked from merging if any of these steps fail.

### Story: `Define-SLOs`
- **As a:** Vimes, the System Architect
- **I want:** The initial, measurable Service Level Objectives (SLOs) for the MVP to be defined.
- **So that:** We have clear, non-functional targets for performance and reliability to build and test against.
- **Acceptance Criteria:**
    - [ ] The `p95` latency target for API endpoints is defined in `Architecture.md`.
    - [ ] The availability target for the service is defined in `Architecture.md`.

### Story: `Setup-Observability`
- **As a:** Dev Team
- **I want:** The chosen observability tools to be integrated into the application.
- **So that:** We can monitor application health, log events, and diagnose issues in our deployed environments.
- **Acceptance Criteria:**
    - [ ] Pino is configured as the logger and outputs structured JSON logs.
    - [ ] Sentry SDK is integrated for Application Performance Monitoring (APM) and error tracking.

### Story: `Implement-Test-Strategy`
- **As a:** Dev Team
- **I want:** The initial configuration for our testing frameworks to be in place.
- **So that:** We can begin writing and running tests for our code.
- **Acceptance Criteria:**
    - [ ] Vitest is configured for unit and integration testing.
    - [ ] Playwright is configured for end-to-end testing.
    - [ ] A script or command exists to easily reset the local and staging databases to a clean, seeded state for consistent test runs.

### Story: `Define-PUMP-Error-Codes`
- **As a:** Dev Team
- **I want:** The initial set of custom PUMP error codes to be defined and documented.
- **So that:** The frontend and backend can communicate errors in a structured and consistent way.
- **Acceptance Criteria:**
    - [ ] The `Custom Error Code Reference` table in `ImplementationGuide.md` is populated with the error codes needed for the initial MVP features (auth, profile, payments, etc.).
